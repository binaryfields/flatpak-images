app-id: com.visualstudio.VSCode
branch: stable
command: code
base: org.electronjs.Electron2.BaseApp
base-version: 18.08
runtime: org.freedesktop.Sdk
runtime-version: 18.08
sdk: org.freedesktop.Sdk
separate-locales: false
finish-args: 
  - --device=dri
  - --filesystem=home
  - --share=ipc
  - --share=network
  - --socket=pulseaudio
  - --socket=x11
  - --talk-name=org.freedesktop.Flatpak
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.freedesktop.secrets
  - --env=NPM_CONFIG_GLOBALCONFIG=/app/etc/npmrc
modules: 
  - name: vscode
    buildsystem: simple
    build-commands:
      - install -D apply_extra /app/bin/apply_extra
      - install -D code.sh /app/bin/code
      - install -Dm644 com.visualstudio.VSCode.desktop /app/share/applications/com.visualstudio.VSCode.desktop
      - install -Dm644 com.visualstudio.VSCode.png /app/share/icons/hicolor/128x128/apps/com.visualstudio.VSCode.png
      - install -Dm644 com.visualstudio.VSCode-64.png /app/share/icons/hicolor/64x64/apps/com.visualstudio.VSCode.png
      - install -Dm644 npmrc /app/etc/npmrc
    sources:
      - type: script
        dest-filename: apply_extra
        commands: 
          - tar xf vscode.tar.gz
          - rm vscode.tar.gz
          - mv VSCode-* vscode
          - install -Dm644 /app/share/applications/com.visualstudio.VSCode.desktop export/share/applications/com.visualstudio.VSCode.desktop
      
      - type: script
        dest-filename: code.sh
        commands: 
          - exec env PATH=$PATH:$HOME/.local/bin:$XDG_DATA_HOME/node_modules/bin /app/extra/vscode/bin/code --extensions-dir=$XDG_DATA_HOME/vscode/extensions $@
      
      - type: file
        path: com.visualstudio.VSCode.desktop
      
      - type: file
        path: com.visualstudio.VSCode.png
      
      - type: file
        path: com.visualstudio.VSCode-64.png
      
      - type: file
        path: npmrc
      
      - type: extra-data
        filename: vscode.tar.gz
        only-arches: [x86_64]
        url: https://vscode-update.azurewebsites.net/1.31.1/linux-x64/stable
        sha256: 154a316eb6785c126e2fccd80a5c76291321ca2d6945e7a2a13f2e262be89bde
        size: 67903381
